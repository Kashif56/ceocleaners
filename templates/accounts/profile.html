{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container my-5">
    
    <!-- Page Heading / Dashboard Title -->
    <div class="text-center mb-5">
        <h2 class="fw-bold mb-1">Welcome to {{ business.businessName }}'s Dashboard</h2>
        <p class="text-muted">Manage your business details, settings, API credentials, and Custom Addons all in one place.</p>
    </div>

    <!-- Nav Tabs -->
    <ul class="nav nav-tabs justify-content-center mb-4" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button 
                class="nav-link active" 
                id="business-info-tab" 
                data-bs-toggle="tab" 
                data-bs-target="#business-info" 
                type="button" 
                role="tab" 
                aria-controls="business-info" 
                aria-selected="true"
            >
                Business Info
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button 
                class="nav-link" 
                id="settings-tab" 
                data-bs-toggle="tab" 
                data-bs-target="#settings" 
                type="button" 
                role="tab" 
                aria-controls="settings" 
                aria-selected="false"
            >
                Settings
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button 
                class="nav-link" 
                id="api-credentials-tab" 
                data-bs-toggle="tab" 
                data-bs-target="#api-credentials" 
                type="button" 
                role="tab" 
                aria-controls="api-credentials" 
                aria-selected="false"
            >
                API Credentials
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button 
                class="nav-link" 
                id="custom-addons-tab" 
                data-bs-toggle="tab" 
                data-bs-target="#custom-addons" 
                type="button" 
                role="tab" 
                aria-controls="custom-addons" 
                aria-selected="false"
            >
                Custom Addons
            </button>
        </li>
      
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="mainTabsContent">
        
        <!-- Business Info Tab -->
<div class="tab-pane fade show active" id="business-info" role="tabpanel" aria-labelledby="business-info-tab">
    <div class="container-fluid py-4">
      <div class="row justify-content-center">
        <div class="col-lg-11">
          <!-- Header Section -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="d-flex align-items-center mb-2">
                <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 60px; height: 60px;">
                  <i class="fas fa-building text-white fs-4"></i>
                </div>
                <div class="text-primary">Business Info</div>
              </div>
            <a href="{% url 'accounts:edit_business' %}" class="btn btn-primary d-flex align-items-center rounded-3 shadow-sm px-4 py-2">
              <i class="fas fa-pen-to-square me-2"></i> 
              <span>Edit Profile</span>
            </a>
          </div>
          
          <!-- Business Info Card -->
          <div class="card border-0 rounded-4 shadow-sm overflow-hidden">
            <!-- Business Banner/Header Area -->
            <div class="bg-primary p-4">
              <div class="row align-items-center">
                <div class="col-md-9">
                  <div class="d-flex align-items-center">
                    <div class="rounded-circle bg-white p-3 d-flex justify-content-center align-items-center shadow-sm me-4"
                    style="width: 50px; height: 50px;"
                    >
                      <i class="fas fa-building text-primary fs-2"></i>
                    </div>
                    <div>
                      <h4 class="fw-bold text-white mb-1">{{ business.businessName }}</h4>
                      <p class="text-white mb-0">Member since {{ business.createdAt|date:"F d, Y" }}</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-3 text-md-end mt-3 mt-md-0">
                  <span class="badge bg-success rounded-pill px-3 py-2">
                    <i class="fas fa-check-circle me-1"></i> Active Business
                  </span>
                </div>
              </div>
            </div>
            
            <!-- Business Details Section -->
            <div class="card-body p-4">
              <div class="row g-4">
                <!-- Business ID -->
                <div class="col-md-6">
                  <div class="p-3 rounded-3 bg-light">
                    <div class="d-flex align-items-center mb-2">
                      <div class="rounded-circle bg-primary p-2 me-2 d-flex justify-content-center align-items-center" style="width: 38px; height: 38px;">
                        <i class="fas fa-fingerprint text-white"></i>
                      </div>
                      <div class="text-muted small">Business ID</div>
                    </div>
                    <div class="fs-5 fw-semibold text-dark">{{ business.businessId }}</div>
                  </div>
                </div>
                
                <!-- Business Name -->
                <div class="col-md-6">
                  <div class="p-3 rounded-3 bg-light">
                    <div class="d-flex align-items-center mb-2">
                      <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 38px; height: 38px;">
                        <i class="fas fa-store text-white"></i>
                      </div>
                      <div class="text-muted small">Business Name</div>
                    </div>
                    <div class="fs-5 fw-semibold text-dark">{{ business.businessName }}</div>
                  </div>
                </div>
                
                <!-- Phone Number -->
                <div class="col-md-6">
                  <div class="p-3 rounded-3 bg-light">
                    <div class="d-flex align-items-center mb-2">
                      <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 38px; height: 38px;">
                        <i class="fas fa-phone-alt text-white"></i>
                      </div>
                      <div class="text-muted small">Phone Number</div>
                    </div>
                    <div class="fs-5 fw-semibold text-dark">
                      <a href="tel:{{ business.phone }}" class="text-dark text-decoration-none">{{ business.phone }}</a> 
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="p-3 rounded-3 bg-light">
                    <div class="d-flex align-items-center mb-2">
                      <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 38px; height: 38px;">
                        <i class="fas fa-envelope text-white"></i>
                      </div>
                      <div class="text-muted small">Email</div>
                    </div>
                    <div class="fs-5 fw-semibold text-dark">
                      <a href="mailto:{{ request.user.email }}" class="text-dark text-decoration-none">{{ request.user.email }}</a> 
                    </div>
                  </div>
                </div>
                
                <!-- Address -->
                <div class="col-md-12">
                  <div class="p-3 rounded-3 bg-light">
                    <div class="d-flex align-items-center mb-2">
                      <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 38px; height: 38px;">
                        <i class="fas fa-map-marker-alt text-white"></i>
                      </div>
                      <div class="text-muted small">Address</div>
                    </div>
                    <div class="fs-5 fw-semibold text-dark">{{ business.address }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- End Business Info Tab -->

        <!-- Settings Tab -->
<div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
    <div class="container-fluid py-4">
      <div class="row justify-content-center">
        <div class="col-lg-11">
          <!-- Header Section -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="d-flex align-items-center">
              <div class="bg-primary bg-opacity-10 rounded-circle p-3 me-3">
                <i class="fas fa-cog text-white fs-4"></i>
              </div>
              <h3 class="fw-bold text-dark m-0">Business Settings</h3>
            </div>
            <a href="{% url 'accounts:edit_business_settings' %}" class="btn btn-primary d-flex align-items-center rounded-3 shadow-sm px-4 py-2">
              <i class="fas fa-pen-to-square me-2"></i> 
              <span>Edit Settings</span>
            </a>
          </div>
          
          <!-- Settings Cards Container -->
          <div class="row g-4">
            <!-- Base Pricing Card -->
            <div class="col-md-6">
              <div class="card border-0 rounded-4 shadow-sm h-100">
                <div class="card-header bg-transparent border-0 pt-4 pb-0 px-4">
                  <div class="d-flex align-items-center mb-2">
                    <div class="bg-primary bg-opacity-10 rounded-3 px-3 py-2 me-3">
                      <i class="fas fa-dollar-sign text-white"></i>
                    </div>
                    <h5 class="card-title fw-bold m-0">Base Pricing</h5>
                  </div>
                </div>
                <div class="card-body p-4 pt-3">
                  <div class="row g-3">
                    <div class="col-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="text-muted small mb-1">Bedroom Price</div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.bedroomPrice }}</div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="text-muted small mb-1">Bathroom Price</div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.bathroomPrice }}</div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="text-muted small mb-1">Deposit Fee</div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.depositFee }}</div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="text-muted small mb-1">Tax Percent</div>
                        <div class="fs-5 fw-semibold text-primary">{{ settings.taxPercent }}%</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Service Multipliers Card -->
            <div class="col-md-6">
              <div class="card border-0 rounded-4 shadow-sm h-100">
                <div class="card-header bg-transparent border-0 pt-4 pb-0 px-4">
                  <div class="d-flex align-items-center mb-2">
                    <div class="bg-primary bg-opacity-10 rounded-3 px-3 py-2 me-3">
                      <i class="fas fa-calculator text-white"></i>
                    </div>
                    <h5 class="card-title fw-bold m-0">Service Multipliers</h5>
                  </div>
                </div>
                <div class="card-body p-4 pt-3">
                  <div class="row g-3">
                    <div class="col-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="text-muted small mb-1">Standard</div>
                        <div class="fs-5 fw-semibold text-primary">{{ settings.sqftMultiplierStandard }}x</div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="text-muted small mb-1">Deep Clean</div>
                        <div class="fs-5 fw-semibold text-primary">{{ settings.sqftMultiplierDeep }}x</div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="text-muted small mb-1">Move In/Out</div>
                        <div class="fs-5 fw-semibold text-primary">{{ settings.sqftMultiplierMoveinout }}x</div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="text-muted small mb-1">Airbnb</div>
                        <div class="fs-5 fw-semibold text-primary">{{ settings.sqftMultiplierAirbnb }}x</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Add-on Prices Card -->
            <div class="col-12">
              <div class="card border-0 rounded-4 shadow-sm">
                <div class="card-header bg-transparent border-0 pt-4 pb-0 px-4">
                  <div class="d-flex align-items-center mb-2">
                    <div class="bg-primary bg-opacity-10 rounded-3 px-3 py-2 me-3">
                      <i class="fas fa-puzzle-piece text-white"></i>
                    </div>
                    <h5 class="card-title fw-bold m-0">Add-on Pricing</h5>
                  </div>
                </div>
                <div class="card-body p-4 pt-3">
                  <div class="row g-3">
                    <!-- First row of add-ons -->
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-utensils text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Dishes</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPriceDishes }}</div>
                      </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-tshirt text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Laundry</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPriceLaundry }}</div>
                      </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-window-maximize text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Windows</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPriceWindow }}</div>
                      </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-paw text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Pets</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPricePets }}</div>
                      </div>
                    </div>
                    
                    <!-- Second row of add-ons -->
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-snowflake text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Fridge</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPriceFridge }}</div>
                      </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-fire text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Oven</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPriceOven }}</div>
                      </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-grip-lines text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Baseboard</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPriceBaseboard }}</div>
                      </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-sliders-h text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Blinds</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPriceBlinds }}</div>
                      </div>
                    </div>
                    
                    <!-- Third row of add-ons -->
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-leaf text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Green Cleaning</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPriceGreen }}</div>
                      </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-box text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Cabinets</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPriceCabinets }}</div>
                      </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-umbrella-beach text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Patio</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPricePatio }}</div>
                      </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                      <div class="p-3 rounded-3 bg-light">
                        <div class="d-flex align-items-center mb-2">
                          <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-2 d-flex justify-content-center align-items-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-warehouse text-white small"></i>
                          </div>
                          <div class="text-dark fw-medium">Garage</div>
                        </div>
                        <div class="fs-5 fw-semibold text-primary">${{ settings.addonPriceGarage }}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- End Settings Tab -->

       <!-- API Credentials Tab -->
<div class="tab-pane fade" id="api-credentials" role="tabpanel" aria-labelledby="api-credentials-tab">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="section-title">API Credentials</h4>
                <a href="{% url 'accounts:edit_credentials' %}" class="btn btn-primary rounded-pill">
                    <i class="bi bi-key me-2"></i>Edit Credentials
                </a>
            </div>

            <!-- Toast for copy notification -->
            <div class="copy-toast" id="copyToast">
                <i class="bi bi-check-circle me-2"></i>Copied to clipboard!
            </div>

            <div class="row g-4 mt-4">
                <!-- Secret Key Card -->
                <div class="col-md-6">
                    <div class="dashboard-card h-100 api-key-card">
                        <div class="card-body">
                            <div class="api-key-wrapper">
                                <span class="badge bg-primary rounded-pill">Primary</span>
                                <div class="api-key-label">
                                    <i class="bi bi-key-fill me-2"></i>Secret Key
                                </div>
                                <div class="input-group mb-3">
                                    <input type="password" 
                                           class="form-control api-key-input masked" 
                                           id="secretKey" 
                                           value="{{ credentials.secretKey }}" 
                                           readonly>
                                    <button class="btn btn-outline-secondary key-action-btn" 
                                            type="button" 
                                            onclick="toggleKey(this, 'secretKey')"
                                            data-bs-toggle="tooltip"
                                            data-bs-placement="top"
                                            title="Show/Hide Key">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-primary key-action-btn"
                                            type="button"
                                            onclick="copyToClipboard('secretKey')"
                                            data-bs-toggle="tooltip"
                                            data-bs-placement="top"
                                            title="Copy to Clipboard">
                                        <i class="fa fa-clipboard me-1"></i>Copy
                                    </button>
                                </div>
                                <small class="text-muted">
                                    <i class="fa fa-lock me-1"></i>
                                    Keep this key secure. Never share it publicly.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Key Card -->
                <div class="col-md-6">
                    <div class="dashboard-card h-100 api-key-card">
                        <div class="card-body">
                            <div class="api-key-wrapper">
                                <span class="badge bg-success rounded-pill">Public</span>
                                <div class="api-key-label">
                                    <i class="fa fa-key me-2"></i>API Key
                                </div>
                                <div class="input-group mb-3">
                                    <input type="password" 
                                           class="form-control api-key-input masked" 
                                           id="apiKey" 
                                           value="{{ credentials.retellAPIKey }}" 
                                           readonly>
                                    <button class="btn btn-outline-secondary key-action-btn" 
                                            type="button" 
                                            onclick="toggleKey(this, 'apiKey')"
                                            data-bs-toggle="tooltip"
                                            data-bs-placement="top"
                                            title="Show/Hide Key">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-primary key-action-btn"
                                            type="button"
                                            onclick="copyToClipboard('apiKey')"
                                            data-bs-toggle="tooltip"
                                            data-bs-placement="top"
                                            title="Copy to Clipboard">
                                        <i class="fa fa-clipboard me-1"></i>Copy
                                    </button>
                                </div>
                                <small class="text-muted">
                                    <i class="fa fa-info-circle me-1"></i>
                                    Use this key for API authentication.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Webhook URL Card -->
                <div class="col-12 pt-4 pb-4">
                    <div class="dashboard-card api-key-card">
                        <div class="card-body">
                            <div class="api-key-wrapper">
                                <span class="badge bg-info rounded-pill">Integration</span>
                                <div class="api-key-label">
                                    <i class="fa fa-globe me-2"></i>Webhook URL
                                    <small class="text-muted">(Use this URL in your Retell dashboard)</small>
                                </div>
                                {% if credentials.secretKey %}
                                    <div class="input-group mb-3">
                                        <input type="text" 
                                               class="form-control api-key-input" 
                                               id="webhookUrl" 
                                               value="https://ceocleaners.up.railway.app/webhook/{{ credentials.secretKey }}/" 
                                               readonly>
                                        <button class="btn btn-outline-primary key-action-btn"
                                                type="button"
                                                onclick="copyToClipboard('webhookUrl')"
                                                data-bs-toggle="tooltip"
                                                data-bs-placement="top"
                                                title="Copy to Clipboard">
                                            <i class="fa fa-clipboard me-1"></i>Copy
                                        </button>
                                    </div>
                                    <small class="text-muted">
                                        <i class="fa fa-link me-1"></i>
                                        This URL will receive webhook events from Retell.
                                    </small>
                                {% else %}
                                    <div class="alert alert-warning mb-0">
                                        <i class="fa fa-exclamation-triangle me-2"></i>
                                        Please set up your secret key first to get your webhook URL.
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GMAIL HOST USER -->
                <div class="col-md-6">
                    <div class="dashboard-card h-100 api-key-card">
                        <div class="card-body">
                            <div class="api-key-wrapper">
                                <span class="badge bg-primary rounded-pill">Private</span>
                                <div class="api-key-label">
                                    <i class="fa fa-user me-2"></i>GMAIL HOST USER
                                </div>
                                <div class="input-group mb-3">
                                    <input type="text" 
                                           class="form-control" 
                                           id="gmail_host_user" 
                                           value="{{ credentials.gmail_host_user }}" 
                                           readonly>
                                  
                                </div>
                                <small class="text-muted">
                                    <i class="fa fa-lock me-1"></i>
                                    Using to send emails from your GMAIL account.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GMAIL HOST PASSWORD -->
                <div class="col-md-6">
                    <div class="dashboard-card h-100 api-key-card">
                        <div class="card-body">
                            <div class="api-key-wrapper">
                                <span class="badge bg-success rounded-pill">Private</span>
                                <div class="api-key-label">
                                    <i class="fa fa-key me-2"></i>GMAIL HOST PASSWORD
                                </div>
                                <div class="input-group mb-3">
                                    <input type="password" 
                                           class="form-control api-key-input masked" 
                                           id="gmail_host_password" 
                                           value="{{ credentials.gmail_host_password }}" 
                                           readonly>
                                    <button class="btn btn-outline-secondary key-action-btn" 
                                            type="button" 
                                            onclick="toggleKey(this, 'gmail_host_password')"
                                            data-bs-toggle="tooltip"    
                                            data-bs-placement="top"
                                            title="Show/Hide Key">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-primary key-action-btn"
                                            type="button"
                                            onclick="copyToClipboard('gmail_host_password')"
                                            data-bs-toggle="tooltip"
                                            data-bs-placement="top"
                                            title="Copy to Clipboard">
                                        <i class="fa fa-clipboard me-1"></i>Copy
                                    </button>
                                </div>
                                <small class="text-muted">
                                    <i class="fa fa-info-circle me-1"></i>
                                    Keep this password Hidden
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>  
        </div>
    </div>
</div>

 <!-- Custom Addons Tab -->
<div class="tab-pane fade" id="custom-addons" role="tabpanel" aria-labelledby="custom-addons-tab">
    <div class="container-fluid py-4">
      <div class="row justify-content-center">
        <div class="col-lg-11">
          <!-- Header Section with Add Button -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="d-flex align-items-center">
              <div class="bg-primary bg-opacity-10 rounded-circle p-3 me-3 mx-auto" 
              style="width: 60px; height: 60px;">
                <i class="fas fa-puzzle-piece text-white fs-4"></i>
              </div>
              <h3 class="fw-bold text-dark m-0">Custom Addons</h3>
            </div>
            <button type="button" class="btn btn-primary d-flex align-items-center rounded-3 shadow px-4 py-2" 
                    data-bs-toggle="modal" data-bs-target="#addCustomAddonModal">
              <i class="fas fa-plus-circle me-2"></i> 
              <span>Add New Addon</span>
            </button>
          </div>
          
          <!-- Search and Filter Bar -->
          <div class="rounded-4 p-3 mb-4">
            <div class="row g-2 align-items-center">
              <div class="col-md-6">
                <div class="input-group">
                  <span class="input-group-text border-end-0">
                    <i class="fas fa-search"></i>
                  </span>
                  <input type="text" class="form-control border-start-0 ps-0" 
                         id="addonSearch" 
                         placeholder="Search addons...">
                </div>
              </div>
              
            </div>
          </div>
  
          <!-- Addons Grid -->
          <div class="row g-4" id="addonsGrid">
            {% for addon in business.business_custom_addons.all %}
            <div class="col-lg-4 col-md-6">
              <div class="card h-100 rounded-4 border-0 shadow-sm hover-shadow transition-300">
                <!-- Card Header -->
                <div class="card-header bg-transparent border-0 pt-4 pb-0 px-4">
                  <div class="d-flex justify-content-between align-items-start">
                    <span class="badge rounded-pill text-bg-primary px-3 py-2">
                      <i class="fas fa-tag me-1"></i> Add-on Service
                    </span>
                    <div class="dropdown">
                      <button class="btn btn-light btn-sm rounded-circle p-2" type="button" data-bs-toggle="dropdown">
                        <i class="fas fa-ellipsis-vertical"></i>
                      </button>
                      <ul class="dropdown-menu dropdown-menu-end shadow border-0 rounded-3">
                        <li>
                          <a class="dropdown-item py-2 edit-addon" href="#"
                            data-addon-id="{{ addon.id }}"
                            data-addon-name="{{ addon.addonName }}"
                            data-addon-data-name="{{ addon.addonDataName }}"
                            data-addon-price="{{ addon.addonPrice }}"
                            data-bs-toggle="modal" 
                            data-bs-target="#editCustomAddonModal">
                            <i class="fas fa-pen-to-square me-2 text-primary"></i> Edit
                          </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                          <a class="dropdown-item py-2 delete-addon text-danger" href="#"
                            data-addon-id="{{ addon.id }}">
                            <i class="fas fa-trash-can me-2"></i> Delete
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
                
                <!-- Card Body -->
                <div class="card-body p-4">
                  <h5 class="card-title fw-bold mb-4 text-dark">{{ addon.addonName }}</h5>
                  
                  <div class="d-flex align-items-center mb-4">
                    <div class="bg-primary bg-opacity-10 rounded-4 p-3 me-3 d-flex justify-content-center align-items-center" style="width: 48px; height: 48px;">
                      <i class="fas fa-dollar-sign text-white"></i>
                    </div>
                    <div>
                      <div class="text-muted small">Price</div>
                      <div class="fs-5 fw-semibold text-primary">${{ addon.addonPrice }}</div>
                    </div>
                  </div>
                  
                  <div class="d-flex align-items-center">
                    <div class="bg-primary bg-opacity-10 rounded-4 p-3 me-3 d-flex justify-content-center align-items-center" style="width: 48px; height: 48px;">
                      <i class="fas fa-code text-white"></i>
                    </div>
                    <div>
                      <div class="text-muted small">Data Name</div>
                      <div class="text-dark">{{ addon.addonDataName }}</div>
                    </div>
                  </div>
                </div>
                
              
              </div>
            </div>
            {% empty %}
            <div class="col-12">
              <div class="card text-center py-5 border-0 rounded-4 shadow-sm">
                <div class="card-body py-5">
                  <div class="bg-primary bg-opacity-10 rounded-circle p-4 d-inline-flex mb-4">
                    <i class="fas fa-puzzle-piece text-primary fs-1"></i>
                  </div>
                  <h4 class="fw-bold text-dark mb-3">No Custom Addons Yet</h4>
                  <p class="text-muted mb-4 mx-auto" style="max-width: 500px;">
                    Create your first custom addon to offer additional services to your customers and increase your revenue potential.
                  </p>
                  <button class="btn btn-primary rounded-3 px-4 py-2 shadow-sm" 
                          data-bs-toggle="modal" data-bs-target="#addCustomAddonModal">
                    <i class="fas fa-plus-circle me-2"></i> Add Your First Addon
                  </button>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          
        
        </div>
      </div>
    </div>
  </div>
  <!-- End Custom Addons Tab -->


      

    </div> <!-- End Tab Content -->
</div> <!-- End .container -->

<!-- Add Custom Addon Modal -->
<div class="modal fade" id="addCustomAddonModal" tabindex="-1" aria-labelledby="addCustomAddonModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addCustomAddonModalLabel">Add Custom Addon</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="addCustomAddonForm" method="post" action="{% url 'accounts:add_custom_addon' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="addonName" class="form-label">Addon Name</label>
                        <input type="text" class="form-control" id="addonName" name="addonName" required>
                    </div>

                    <div class="mb-3">
                        <label for="addonDataName" class="form-label">Addon Data Name</label>
                        <input type="text" class="form-control" id="addonDataName" name="addonDataName" readonly>
                        <small class="text-muted">
                            <i class="fa fa-lock me-1"></i>
                            This will be automatically generated from the addon name
                        </small>
                    </div>

                    <div class="mb-3">
                        <label for="addonPrice" class="form-label">Price</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" step="0.01" class="form-control" id="addonPrice" name="addonPrice" required>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Addon</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Custom Addon Modal -->
<div class="modal fade" id="editCustomAddonModal" tabindex="-1" aria-labelledby="editCustomAddonModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCustomAddonModalLabel">Edit Custom Addon</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editAddonForm">
                {% csrf_token %}
                <div class="modal-body">
                    <input type="hidden" id="editAddonId">
                    <div class="mb-3">
                        <label for="editAddonName" class="form-label">Addon Name</label>
                        <input type="text" class="form-control" id="editAddonName" name="addonName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editAddonDataName" class="form-label">Addon Data Name</label>
                        <input type="text" class="form-control" id="editAddonDataName" name="addonDataName" readonly>
                        <small class="text-muted">
                            <i class="fa fa-lock me-1"></i>
                            This will be automatically generated from the addon name
                        </small>
                    </div>
                    <div class="mb-3">
                        <label for="editAddonPrice" class="form-label">Price</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" step="0.01" class="form-control" id="editAddonPrice" name="addonPrice" required>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .api-key-card {
        background: #f8f9fa;
    }
    .api-key-input {
        background: white !important;
        font-family: monospace;
        letter-spacing: 1px;
    }
    .api-key-input.masked {
        letter-spacing: 3px;
    }
    .copy-toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        display: none;
        z-index: 1050;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .api-key-wrapper {
        position: relative;
    }
    .api-key-wrapper .badge {
        position: absolute;
        top: -10px;
        right: -10px;
        z-index: 1;
    }
    .key-action-btn {
        min-width: 100px;
    }
    .api-key-label {
        font-size: 0.85rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: #6c757d;
        margin-bottom: 8px;
    }
</style>

{% endblock content %}

{% block scripts %}
<script>
    // Function to generate data name from addon name
    function generateDataName(addonName) {
        return addonName.toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/^_+|_+$/g, '');
    }

    // Function to show/hide secret key
    function toggleSecretKey(button) {
        const secretKey = button.previousElementSibling;
        if (secretKey.textContent === '•••••••••••••••') {
            secretKey.textContent = secretKey.dataset.key;
            button.textContent = 'Hide';
        } else {
            secretKey.textContent = '•••••••••••••••';
            button.textContent = 'Show';
        }
    }

    // Function to copy webhook URL
    function copyWebhookUrl(button) {
        const webhookUrl = 'https://ceocleaners.up.railway.app/webhook/{{ credentials.secretKey }}/';
        navigator.clipboard.writeText(webhookUrl).then(() => {
            button.textContent = 'Copied!';
            setTimeout(() => {
                button.textContent = 'Copy';
            }, 2000);
        });
    }

    // Wait for DOM to be loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Handle addon name input for new addon
        const addonNameInput = document.getElementById('addonName');
        const addonDataNameInput = document.getElementById('addonDataName');
        
        if (addonNameInput) {
            addonNameInput.addEventListener('input', function() {
                const dataName = generateDataName(this.value);
                addonDataNameInput.value = dataName;
            });
        }

        // Handle addon name input for edit addon
        const editAddonNameInput = document.getElementById('editAddonName');
        const editAddonDataNameInput = document.getElementById('editAddonDataName');
        
        if (editAddonNameInput) {
            editAddonNameInput.addEventListener('input', function() {
                const dataName = generateDataName(this.value);
                editAddonDataNameInput.value = dataName;
            });
        }

        // Handle new addon form submission
        const addCustomAddonForm = document.getElementById('addCustomAddonForm');
        if (addCustomAddonForm) {
            addCustomAddonForm.addEventListener('submit', function() {
                const addonName = addonNameInput.value;
                const dataName = generateDataName(addonName);
                addonDataNameInput.value = dataName;
            });
        }

        // Handle edit form submission
        const editAddonForm = document.getElementById('editAddonForm');
        if (editAddonForm) {
            editAddonForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const addonId = document.getElementById('editAddonId').value;
                const addonName = editAddonNameInput.value;
                const dataName = generateDataName(addonName);
                editAddonDataNameInput.value = dataName;

                fetch(`/account/custom-addon/${addonId}/edit/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(new FormData(editAddonForm))
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        window.location.reload();
                    }
                })
                .catch(() => {
                    alert('Error updating addon');
                });
            });
        }

        // Handle delete buttons
        document.querySelectorAll('.delete-addon').forEach(button => {
            button.addEventListener('click', function() {
                if (confirm('Are you sure you want to delete this addon?')) {
                    const addonId = this.dataset.addonId;
                    fetch(`/account/custom-addon/${addonId}/delete/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            window.location.reload();
                        }
                    })
                    .catch(() => {
                        alert('Error deleting addon');
                    });
                }
            });
        });

        // Handle edit buttons
        document.querySelectorAll('.edit-addon').forEach(button => {
            button.addEventListener('click', function() {
                const addonId = this.dataset.addonId;
                const addonName = this.dataset.addonName;
                const addonDataName = this.dataset.addonDataName;
                const addonPrice = this.dataset.addonPrice;

                document.getElementById('editAddonId').value = addonId;
                document.getElementById('editAddonName').value = addonName;
                document.getElementById('editAddonDataName').value = addonDataName;
                document.getElementById('editAddonPrice').value = addonPrice;
            });
        });
    });
</script>

<script>
    // Function to toggle key visibility
    function toggleKey(button, inputId) {
        const input = document.getElementById(inputId);
        const icon = button.querySelector('i');
        
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
            input.classList.remove('masked');
        } else {
            input.type = 'password';
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
            input.classList.add('masked');
        }
    }

    // Function to copy to clipboard
    function copyToClipboard(inputId) {
        const input = document.getElementById(inputId);
        const toast = document.getElementById('copyToast');
        
        // Select the text
        input.select();
        input.setSelectionRange(0, 99999); // For mobile devices
        
        // Copy the text
        navigator.clipboard.writeText(input.value).then(() => {
            // Show toast
            toast.style.display = 'block';
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        });
    }

    // Initialize tooltips
    document.addEventListener('DOMContentLoaded', function() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('addonSearch');
        const addonsGrid = document.getElementById('addonsGrid');
        
        // Store original addons for reset
        const originalAddons = Array.from(addonsGrid.children);
        
        function searchAddons() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            // Create a copy of the original addons
            let filteredAddons = [...originalAddons];
            
            // Apply search filter if there's a search term
            if (searchTerm) {
                filteredAddons = filteredAddons.filter(addon => {
                    const addonName = addon.querySelector('.card-title').textContent.toLowerCase();
                    const addonPrice = addon.querySelector('.fs-5.fw-semibold.text-primary').textContent;
                    const addonDataName = addon.querySelector('.text-dark').textContent.toLowerCase();
                    return addonName.includes(searchTerm) || 
                           addonPrice.includes(searchTerm) || 
                           addonDataName.includes(searchTerm);
                });
            }
            
            // Clear and repopulate the grid
            addonsGrid.innerHTML = '';
            if (filteredAddons.length === 0) {
                addonsGrid.innerHTML = `
                    <div class="col-12">
                        <div class="card text-center py-5 border-0 rounded-4 shadow-sm">
                            <div class="card-body">
                                <div class="bg-primary bg-opacity-10 rounded-circle p-3 d-inline-flex mb-4">
                                    <i class="fas fa-search text-primary fs-4"></i>
                                </div>
                                <h5 class="text-dark mb-3">No Addons Found</h5>
                                <p class="text-muted">Try adjusting your search criteria</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                filteredAddons.forEach(addon => addonsGrid.appendChild(addon));
            }
        }
        
        // Add event listener for search input
        searchInput.addEventListener('input', searchAddons);
    });
</script>
{% endblock %}
